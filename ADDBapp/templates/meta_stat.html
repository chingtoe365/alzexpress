{% extends "base.html" %}

{% block content %}
	<h2 style="text-align:center">Meta-analysis result for this group</h2>
	
	<table class="table table-striped table-borderless">
		<thead>
	    <tr>
	        <th>Feature</th>
	        <th>Meta t-score</th>
	        <th>Meta p-value</th>
	        <th><span>Adjusted p-value <br> (BH)</span></th>
	        <th><span>Adjusted p-value <br> (Bonferroni)</span></th>
	        <th><span>Adjusted p-value <br> (BH, common features)</span></th>
	        <th><span>Adjusted p-value <br> (Bonferroni, common features)</span></th>
	        <th>Significance</th>
	        <th>Effect</th>
	    </tr>
	    </thead>
	    <tbody>
    		{% for feature in meta_stat_queried %}
			<tr>
				<td>{{ feature.symb }}</td>
				<td>{{ feature.tsco|floatformat:"-3" }}</td>
				<td>{{ feature.pval|floatformat:"-3" }}</td>
				<td>{{ feature.bhp|floatformat:"-3" }}</td>
				<td>{{ feature.bfp|floatformat:"-3" }}</td>
				<td>{{ feature.cbhp|floatformat:"-3" }}</td>
				<td>{{ feature.cbfp|floatformat:"-3" }}</td>
				<td>{{ feature.bfsig }}</td>
				<td>{{ feature.eff }}</td>

			</tr>
	    	{% endfor %}
	    </tbody>

	</table>


	<table class="table table-striped table-borderless" id="top_display">
		<h3 style="text-align:center;">Top 10 features by Meta p-value</h3>
		Filtered by
		<select id="feature_filters">
			<option value=1>Union features</option>
			<option value=2>Common features</option>
		</select>
		<thead>
	    <tr>
	        <th>Feature</th>
	        <th>Meta t-score</th>
	        <th>Meta p-value</th>
	        <th><span>Adjusted p-value <br> (BH)</span></th>
	        <th><span>Adjusted p-value <br> (Bonferroni)</span></th>
	        <th><span>Adjusted p-value <br> (BH, common features)</span></th>
	        <th><span>Adjusted p-value <br> (Bonferroni, common features)</span></th>
	        <th>Significance</th>
	        <th>Effect</th>
	    </tr>
	    </thead>
	    <tbody>
    		{% for feature in meta_stat_top_10 %}
			<tr>
				<td>{{ feature.symb }}</td>
				<td>{{ feature.tsco|floatformat:"-3"  }}</td>
				<td>{{ feature.pval|floatformat:"-3"  }}</td>
				<td>{{ feature.bhp|floatformat:"-3"  }}</td>
				<td>{{ feature.bfp|floatformat:"-3"  }}</td>
				<td>{{ feature.cbhp|floatformat:"-3"  }}</td>
				<td>{{ feature.cbfp|floatformat:"-3"  }}</td>
				<td>{{ feature.bfsig }}</td>
				<td>{{ feature.eff }}</td>

			</tr>
	    	{% endfor %}
	    </tbody>

	</table>

	<table class="table table-striped table-borderless" >
		<h3 style="text-align:center;">Meta Info</h3>
		<thead>
			<tr>
				<th>Dataset</th>
				<th>Sample Count</th>
				<th>State 1 Sample Count</th>
				<th>State 0 Sample Count</th>
				<th>Feature Count</th>
				<th>Union Feature Count</th>
				<th>Intersect Feature Count</th>
			</tr>
		</thead>
		<tbody>
			{% for info in meta_info %}
			<tr>
				<td>{{ info.dataset_accession }}</td>
				<td>{{ info.sample_count }}</td>
				<td>{{ info.state_1_count }}</td>
				<td>{{ info.state_0_count }}</td>
				<td>{{ info.feature_count }}</td>
				{% if forloop.counter == 1 %}
				<td>{{ union_feature_count }}</td>
				<td>{{ intersect_feature_count }}</td>
				{% else %}
				<td></td>
				<td></td>
				{% endif %}
			</tr>
			{% endfor %}
		</tbody>
	</table>

{% endblock %}

{% block styles %}

{% endblock %}

{% block scripts %}
<script type="text/javascript">
	$(function(){
		$('#feature_filters').change(function(){
			// alert($(this).val());
			// alert("hello");
			var index = $(this).val();
			$.ajax({
				url : '/get_top_tables/',
				type : 'POST',
				data : {
					'feature_filter_type' : index,
					'collection_name' : '{{ collection_name }}'
				},
				success: function(json){
					// console.log(json);
					content = json['result'];
					console.log(content)
					$('#top_display tbody').html(content);
				},
				error: function(json){
					console.log('there is error in ajax');
				}
			})
		});
	})
</script>
{% endblock %}
